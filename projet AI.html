<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tableau de Bord - Gestion d'Argent √âtudiant</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js">
function telechargerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;

  doc.setFontSize(16);
  doc.text("R√©sum√© Financier √âtudiant", 10, y);
  y += 10;

  doc.setFontSize(12);
  doc.text(`Total Revenu : ${revenus.toFixed(2)} fcfa`, 10, y);
  y += 10;

  const totalDepense = depenses.reduce((sum, d) => sum + d.montant, 0);
  doc.text(`Total D√©pense : ${totalDepense.toFixed(2)} fcfa`, 10, y);
  y += 10;

  doc.text("D√©tails des D√©penses :", 10, y);
  y += 10;

  depenses.forEach((d, index) => {
    if (y > 280) {
      doc.addPage();
      y = 10;
    }
    doc.text(`${index + 1}. ${d.date} - ${d.type} : ${d.montant.toFixed(2)} fcfa`, 10, y);
    y += 8;
  });

  doc.save("budget_etudiant.pdf");
}

  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f5f5f5;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .expense-icon {
      width: 24px;
      height: 24px;
      margin-right: 5px;
    }
    .form-section {
      margin-bottom: 30px;
    }
  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
function telechargerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;

  doc.setFontSize(16);
  doc.text("R√©sum√© Financier √âtudiant", 10, y);
  y += 10;

  doc.setFontSize(12);
  doc.text(`Total Revenu : ${revenus.toFixed(2)} fcfa`, 10, y);
  y += 10;

  const totalDepense = depenses.reduce((sum, d) => sum + d.montant, 0);
  doc.text(`Total D√©pense : ${totalDepense.toFixed(2)} fcfa`, 10, y);
  y += 10;

  doc.text("D√©tails des D√©penses :", 10, y);
  y += 10;

  depenses.forEach((d, index) => {
    if (y > 280) {
      doc.addPage();
      y = 10;
    }
    doc.text(`${index + 1}. ${d.date} - ${d.type} : ${d.montant.toFixed(2)} fcfa`, 10, y);
    y += 8;
  });

  doc.save("budget_etudiant.pdf");
}

  </script>
</head>
<body>
  <div class="container">
    <h1 class="text-center mb-4">Gestion de mon argent</h1>
    <div style="position: absolute; top: 20px; left: 20px;">
      <button class="btn btn-secondary" onclick="window.location.href='projets.html'">Retour</button>
    </div>

    <div class="form-section">
      <h4>Ajouter un revenu</h4>
      <div class="input-group mb-3">
        <input type="number" id="revenu" class="form-control" placeholder="Montant du revenu">
        <button class="btn btn-success" onclick="ajouterRevenu()">Ajouter</button>
      </div>
    </div>

    <div class="form-section">
      <h4>Ajouter une d√©pense</h4><h6 style="color: red;">Date obligatoire</h6>
      <div class="row g-2">
        <div class="col-md-4">
          <input type="number" id="depense" class="form-control" placeholder="Montant de la d√©pense">
        </div>
        <div class="col-md-4">
          <input type="date" id="dateDepense" class="form-control">
        </div>
        <div class="col-md-4">
          <select id="typeDepense" class="form-select"></select>
        </div>
      </div>
      <div class="mt-2">
        <button class="btn btn-danger" onclick="ajouterDepense()">Ajouter</button>
      </div>
    </div>

    <div class="form-section">
      <h4>Solde actuel</h4>
      <h2 id="solde">0 fcfa</h2>
    </div>

    <div class="form-section">
      <h4>R√©partition des d√©penses</h4>
      <canvas id="chartDepenses"></canvas>
    </div>

    <div class="form-section">
      <h4>D√©penses par mois et par type</h4>
      <canvas id="chartMensuel"></canvas>
    
    <div class="form-section text-end">
      <button class="btn btn-primary" onclick="telechargerPDF()">T√©l√©charger en PDF</button>
    </div>

  </div>

  <script>
    let revenus = 0;
    let depenses = [];

    const depenseTypes = {
      "üçî Restaurant": "Restaurant", "üîß R√©paration": "R√©paration", "üí∏ Dette": "Dette", "‚õΩ Essence": "Essence",
      "üõí √âpicerie": "√âpicerie", "üöå Transport": "Transport", "üì∫ Abonnement Netflix": "Abonnement Netflix",
      "üéµ Abonnement Spotify": "Abonnement Spotify", "‚òï Caf√©": "Caf√©", "üç´ Snack": "Snack",
      "üìö Livres": "Livres", "‚úèÔ∏è Mat√©riel scolaire": "Mat√©riel scolaire", "üëï V√™tements": "V√™tements",
      "üëü Chaussures": "Chaussures", "üéâ Sortie": "Sortie", "üé¨ Cin√©ma": "Cin√©ma",
      "‚úàÔ∏è Voyage": "Voyage", "üè† Location": "Location", "üõ°Ô∏è Assurance": "Assurance",
      "üåê Internet": "Internet", "üì± T√©l√©phone": "T√©l√©phone", "üí° √âlectricit√©": "√âlectricit√©",
      "üö∞ Eau": "Eau", "üè¶ Frais bancaires": "Frais bancaires", "‚öïÔ∏è Frais m√©dicaux": "Frais m√©dicaux",
      "üë®‚Äç‚öïÔ∏è M√©decin": "M√©decin", "üíä Pharmacie": "Pharmacie", "üíá‚Äç‚ôÇÔ∏è Coiffeur": "Coiffeur",
      "üß¥ Produits de beaut√©": "Produits de beaut√©", "üßº Hygi√®ne": "Hygi√®ne", "üèãÔ∏è‚Äç‚ôÇÔ∏è Abonnement sport": "Abonnement sport",
      "üèãÔ∏è Salle de sport": "Salle de sport", "üéÆ Jeux vid√©o": "Jeux vid√©o", "üñ•Ô∏è Mat√©riel informatique": "Mat√©riel informatique",
      "üíª PC": "PC", "üîë Cl√© USB": "Cl√© USB", "üñ®Ô∏è Impression": "Impression",
      "üìÑ Papeterie": "Papeterie", "üöñ Taxi": "Taxi", "üöó Uber": "Uber", "üö≤ V√©lo": "V√©lo",
      "üöÜ Bus": "Bus", "üöÑ Train": "Train", "üìë Frais de dossier": "Frais de dossier",
      "üè´ Inscription universit√©": "Inscription universit√©", "üí∞ Caution": "Caution",
      "üéì Frais de scolarit√©": "Frais de scolarit√©", "üìò Cours priv√©s": "Cours priv√©s",
      "üë®‚Äçüè´ Tutorat": "Tutorat", "üéÅ Cadeaux": "Cadeaux", "üéÇ Anniversaire": "Anniversaire",
      "üôè Don": "Don", "ü§ù B√©n√©volat": "B√©n√©volat", "üéä √âv√©nement √©tudiant": "√âv√©nement √©tudiant",
      "üçª Soir√©e": "Soir√©e", "üç∫ Bi√®re": "Bi√®re", "üç∑ Vin": "Vin", "ü•§ Boisson": "Boisson",
      "üçü Repas rapide": "Repas rapide", "üçï Pizzeria": "Pizzeria", "ü•ô Kebab": "Kebab",
      "ü•™ Sandwich": "Sandwich", "üß≥ Frais de voyage": "Frais de voyage", "üÖøÔ∏è Parking": "Parking",
      "üõ£Ô∏è P√©age": "P√©age", "üîß Entretien voiture": "Entretien voiture", "üõ¢Ô∏è Huile moteur": "Huile moteur",
      "üßº Lavage voiture": "Lavage voiture", "üìã Frais d'examen": "Frais d'examen",
      "üöó Permis de conduire": "Permis de conduire", "üìù Test code": "Test code",
      "‚è∞ Retard de paiement": "Retard de paiement", "üö® Amende": "Amende",
      "üìÑ Taxes": "Taxes", "üóûÔ∏è Abonnement journal": "Abonnement journal",
      "üé® Mat√©riel artistique": "Mat√©riel artistique", "üñåÔ∏è Peinture": "Peinture",
      "üéº Musique": "Musique", "üé∏ Instrument": "Instrument", "üñ®Ô∏è Photocopie": "Photocopie",
      "üì∑ Scanner": "Scanner", "üì¶ Fournitures diverses": "Fournitures diverses",
      "‚ùì D√©penses impr√©vues": "D√©penses impr√©vues", "üîã Batterie t√©l√©phone": "Batterie t√©l√©phone",
      "üîå Chargeur": "Chargeur", "üîå Adaptateur": "Adaptateur", "üíæ Carte m√©moire": "Carte m√©moire",
      "üì± Accessoire t√©l√©phone": "Accessoire t√©l√©phone", "üé´ Carnet de tickets": "Carnet de tickets",
      "üîë Cl√© perdue": "Cl√© perdue", "üßæ Frais de remplacement": "Frais de remplacement",
      "‚òï Caf√© universitaire": "Caf√© universitaire", "üíß Bouteille d'eau": "Bouteille d'eau",
      "üç¨ Bonbons": "Bonbons", "üç´ Chocolat": "Chocolat", "üç¶ Glace": "Glace",
      "üçî Fast-food": "Fast-food", "üé≠ √âv√©nement culturel": "√âv√©nement culturel"
    };

    const select = document.getElementById("typeDepense");
    for (let [emoji, type] of Object.entries(depenseTypes)) {
      const option = document.createElement("option");
      option.textContent = emoji;
      option.value = type;
      select.appendChild(option);
    }

    function ajouterRevenu() {
      const montant = parseFloat(document.getElementById("revenu").value);
      if (!isNaN(montant)) {
        revenus += montant;
        document.getElementById("revenu").value = "";
        mettreAJour();
      }
    }

    function ajouterDepense() {
      const montant = parseFloat(document.getElementById("depense").value);
      const date = document.getElementById("dateDepense").value;
      const type = document.getElementById("typeDepense").value;

      if (!isNaN(montant) && date && type) {
        depenses.push({ montant, date, type });
        document.getElementById("depense").value = "";
        mettreAJour();
      }
    }

    function mettreAJour() {
      const totalDepense = depenses.reduce((sum, d) => sum + d.montant, 0);
      const solde = revenus - totalDepense;
      document.getElementById("solde").textContent = solde.toFixed(2) + " fcfa";
      afficherGraphique();
      afficherGraphiqueMensuel();
    }

    function afficherGraphique() {
      const grouped = {};
      depenses.forEach(d => {
        if (!grouped[d.type]) grouped[d.type] = 0;
        grouped[d.type] += d.montant;
      });

      const ctx = document.getElementById('chartDepenses').getContext('2d');
      if (window.chartInstance) window.chartInstance.destroy();
      window.chartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(grouped),
          datasets: [{
            data: Object.values(grouped),
            backgroundColor: Object.keys(grouped).map(() => '#' + Math.floor(Math.random()*16777215).toString(16))
          }]
        }
      });
    }

    function afficherGraphiqueMensuel() {
      const parMoisEtType = {};
      depenses.forEach(d => {
        const mois = new Date(d.date).toLocaleString('fr-FR', { month: 'short', year: 'numeric' });
        if (!parMoisEtType[mois]) parMoisEtType[mois] = {};
        if (!parMoisEtType[mois][d.type]) parMoisEtType[mois][d.type] = 0;
        parMoisEtType[mois][d.type] += d.montant;
      });

      const moisLabels = Object.keys(parMoisEtType);
      const tousTypes = new Set();
      moisLabels.forEach(mois => {
        Object.keys(parMoisEtType[mois]).forEach(type => tousTypes.add(type));
      });

      const datasets = Array.from(tousTypes).map(type => {
        return {
          label: type,
          data: moisLabels.map(mois => parMoisEtType[mois][type] || 0),
          backgroundColor: '#' + Math.floor(Math.random() * 16777215).toString(16)
        };
      });

      const ctx = document.getElementById('chartMensuel').getContext('2d');
      if (window.barChartInstance) window.barChartInstance.destroy();
      window.barChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: moisLabels,
          datasets: datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'R√©partition des d√©penses par mois et type' }
          },
          scales: {
            x: { stacked: true },
            y: { stacked: true }
          }
        }
      });
    }
  
function telechargerPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  let y = 10;

  doc.setFontSize(16);
  doc.text("R√©sum√© Financier √âtudiant", 10, y);
  y += 10;

  doc.setFontSize(12);
  doc.text(`Total Revenu : ${revenus.toFixed(2)} fcfa`, 10, y);
  y += 10;

  const totalDepense = depenses.reduce((sum, d) => sum + d.montant, 0);
  doc.text(`Total D√©pense : ${totalDepense.toFixed(2)} fcfa`, 10, y);
  y += 10;

  doc.text("D√©tails des D√©penses :", 10, y);
  y += 10;

  depenses.forEach((d, index) => {
    if (y > 280) {
      doc.addPage();
      y = 10;
    }
    doc.text(`${index + 1}. ${d.date} - ${d.type} : ${d.montant.toFixed(2)} fcfa`, 10, y);
    y += 8;
  });

  doc.save("budget_etudiant.pdf");
}

  </script>
</body>
</html>
